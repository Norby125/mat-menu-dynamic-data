<button mat-icon-button [matMenuTriggerFor]="mainMenu">
  <mat-icon>{{ icon() }}</mat-icon>
</button>

<mat-menu #mainMenu="matMenu">
  @for (node of rootActions(); track node) {
    <button mat-menu-item [disabled]="node.disabled">
      @if (atLeastOneRootActionHasIcon()) {
        <mat-icon> {{ node.icon }}</mat-icon>
      }
      {{ node.displayName }}
    </button>
  }
  @for (node of rootGroups(); track node) {
    <ipl-menu-section [node]="node">
      @for (subnode of node.nodes; track subnode) {
        @if (subnode.nodeType === 'group') {
          <button mat-menu-item [matMenuTriggerFor]="menuItem.matMenu() ?? null">
            <mat-icon> {{ subnode.icon }}</mat-icon>
            {{ subnode.displayName }}
            <ipl-menu-flyout #menuItem [nodes]="subnode.nodes" />
          </button>
        } @else if (subnode.nodeType === 'action') {
          <button mat-menu-item [disabled]="subnode.disabled">
            <mat-icon> {{ subnode.icon }}</mat-icon>
            {{ subnode.displayName }}
          </button>
        }
      }
    </ipl-menu-section>
  }
</mat-menu>
